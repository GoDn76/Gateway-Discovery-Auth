services:
  # --- 1. SERVICE DISCOVERY (Eureka) ---
  service-discovery:
    build: 
      context: ./ServiceDiscovery
      dockerfile: Dockerfile
    container_name: service-discovery
    ports:
      - "8761:8761" # Exposes Eureka to the VM's localhost
    environment:
      - JAVA_OPTS=-Xmx256m -Xms256m
    networks:
      - symptom-network

  # --- 2. API GATEWAY ---
  gateway-service:
    build: 
      context: ./GatewayService
      dockerfile: Dockerfile
    container_name: gateway-service
    # ðŸš€ HOST MODE: This allows Gateway to see the SSH Tunnel on localhost:8081
    network_mode: "host" 
    environment:
      - JAVA_OPTS=-Xmx256m -Xms256m
      # Finds Eureka on VM Localhost
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://localhost:8761/eureka/
      # Ensure Gateway application.yml has: server.port: ${SERVER_PORT:8080}
      - SERVER_PORT=80 
      # Ensure your JWT Secret is passed here if using .env
      - JWT_SECRET=${JWT_SECRET}

networks:
  symptom-network:
    driver: bridge